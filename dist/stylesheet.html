<style>
/* ==========================================================================
   基本設定とカラーパレット (rulebook.cssより抜粋・調整)
   ========================================================================== */
:root {
    --primary-color:    #138; 
    --secondary-color:  #16c; 
    --background-color: #def; 
    --surface-color:    #fffd;
    --text-color:       #222; 
    --border-color:     #aaa; 
    --quote-bg-color:   #eef; 
    --code-bg-color:    #ddd; 
    --link-color:       #27d; 
    --success-color:    #5b5; 
    --failure-color:    #f43;
}
html {
  font-size: 100%;
}
body { 
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif; 
  line-height: 1.4; 
  background-color: var(--background-color); 
  color: var(--text-color); 
  margin: 0; 
  padding: 0.5rem;
  height: 100dvh;
}
footer {
  margin-bottom: 20rem;
}
footer p {
  font-weight: normal;
  font-size: 0.8rem;
  color: #666;
}
h1, h2, h3, h4 { 
  color: var(--primary-color); 
}
h1 { 
  text-align: center;
  font-size: 2rem; 
  margin-top: 0.5rem; 
}
h2 { 
  font-size: 1.5rem; 
  margin-top: 1.0rem; 
}
h3 { 
  font-size: 1.25rem; 
}
h4 { 
  font-size: 1rem; 
}
small {
  font-size: 0.8em;
}
.info {
  font-size: 0.8rem;
  font-weight: normal;
}
/*  */
.container { 
  max-width: 900px; 
  margin: 0.5rem; 
  margin-bottom: 1rem;
  padding: 1rem; 
  background-color: var(--surface-color); 
  border-radius: 0.5rem; 
  box-shadow: 0 0 0.5rem #0128; 
}
.form-group { 
  margin-bottom: 1rem; 
}

/* ==========================================================================
   フォーム要素のスタイル修正
   ========================================================================== */
label { 
  font-weight: bold; 
  display: block; 
  margin-bottom: 0.5rem; 
  color: var(--primary-color); 
}
/* ▼▼▼ 修正: type="number", password, textarea を追加 ▼▼▼ */
input[type="text"], 
input[type="number"], 
input[type="password"],
select,
textarea { 
  width: 100%; 
  padding: 0.8rem; 
  border: 1px solid var(--border-color); 
  border-radius: 8px; 
  font-size: 1.1rem; 
  box-sizing: border-box; /* パディングを含めて幅を計算 */
  background-color: #fff;
}
/* 数値入力のスピンボタン（上下矢印）のデザイン調整（オプション） */
/* ブラウザによってはレイアウト崩れの原因になるため、必要に応じて調整 */
input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
    height: auto;
}

input[readonly] { 
  background-color: #8cf; 
  cursor: not-allowed; 
}

button { 
  background-color: var(--primary-color); 
  color: white; 
  padding: 0.3rem 1.0rem; 
  border: none; 
  border-radius: 8px; 
  font-size: 1em; 
  cursor: pointer; 
  transition: background-color 0.2s; 
  margin-right: 0.5rem; 
}
button:hover { 
  background-color: var(--secondary-color); 
}
.button-secondary { 
  background-color: #6c757d; 
} 
.button-secondary:hover { 
  background-color: #5a6268; 
}
.button-success { 
  background-color: var(--success-color); 
} 
.button-success:hover { 
  background-color: #45a049; 
}
.button-danger { 
  background-color: var(--failure-color); 
} 
.button-danger:hover { 
  background-color: #d32f2f; 
}
.grid { 
  display: grid; 
  grid-template-columns: 1fr 1fr; 
  gap: 1rem; 
}
.col-span-2 { 
  grid-column: span 2; 
}

/* 3カラムグリッドのスタイル */
.grid-3-col { 
  display: grid; 
  grid-template-columns: repeat(3, 1fr); /* 3等分 */
  gap: 1rem; 
}
/* グリッド内のdivが最低幅を持たないようにする（入力欄のはみ出し防止） */
.grid-3-col > div {
  min-width: 0;
}
.grid-3-col input { 
  /* 個別のパディング指定は削除し、上の共通スタイルに任せる */
  /* padding: 0.5rem; */
}

#char-list { 
  list-style: none; 
  padding: 0; 
}
#char-list li { 
  background: #fff; 
  border: 1px solid var(--border-color); 
  padding: 0.5rem 1rem; 
  margin-bottom: 0.5rem; 
  display: flex; 
  justify-content: space-between; 
  align-items: center; 
  border-radius: 0.5rem; 
  font-weight: normal;
}

#status-message { 
  margin-top: 1rem; 
  padding: 1rem; 
  border-radius: 4px; 
  text-align: center; 
  display: none; 
}
.status-success { 
  background-color: #d4edda; 
  color: #155724; 
  border: 1px solid #c3e6cb; 
}
.status-error { 
  background-color: #f8d7da; 
  color: #721c24; 
  border: 1px solid #f5c6cb; 
}

table { 
  width: 100%; 
  border-collapse: collapse; 
  margin: 1rem 0;
  border-radius: 2rem;
  box-shadow: 0 0 0.5rem #0128;
  overflow: hidden;
  box-sizing: border-box; 
}
th, td { 
  border: none; 
  padding: 0.5rem 1rem; 
}
th { 
  text-align: left; 
  background-color: var(--background-color); 
}
td { 
  text-align: center;
  background-color: #fffa; 
}

/* 認証エリアのスタイル */
.auth-container {
    background-color: #eef;
    padding: 1rem;
    border-radius: 8px;
    border: 1px solid var(--border-color);
    margin-bottom: 1rem;
}
.auth-container input[type="password"] {
    font-family: monospace; /* パスワード文字を見やすく */
}

/* ================================================================
   アコーディオン（汎用化）
   ================================================================ */

/* --- トリガー要素（クリックする部分）のスタイル --- */
.accordion-trigger {
    cursor: pointer;
    user-select: none;
    position: relative;
    margin: 0.5rem 0 0 0;
    padding: 0.5rem;
    padding-left: 2em; 
    font-weight: bold;
    background-color: var(--background-color);
    border-radius: 0.5rem;
}

/* --- 開いた状態のトリガーのスタイル --- */
.accordion-trigger.active {
    background-color: #defa;
    border-radius: 0.5rem 0.5rem 0 0;
}

/* --- カスタム矢印（▼）のスタイル --- */
.accordion-trigger .arrow {
    position: absolute;
    /* leftとwidthで位置と幅を固定 */
    left: 0;
    top: 0;
    bottom: 0;
    width: 2em; /* 矢印のクリック領域と配置の基準幅 */

    /* Flexboxを使って内部の「▼」記号を中央揃えにする */
    display: flex;
    align-items: center;
    justify-content: center;

    transform: rotate(-90deg); /* 親要素ではなく、span自体を回転させる */
    transition: transform 0.3s ease-in-out;
}
/* 疑似要素で矢印を描画する */
.accordion-trigger .arrow::before {
    content: '▼';
}
/* --- 開いた状態の矢印の回転 --- */
.accordion-trigger.active .arrow {
    transform: rotate(0deg);
}

/* --- コンテンツエリアのスタイル --- */
.accordion-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-in-out;
    background-color: #def4;
    border-radius: 0 0 0.5rem 0.5rem;
    margin: 0;
    padding: 0 0.5rem;
}

/* --- 開いた状態のコンテンツのスタイル --- */
/* .accordion-content.active {
    padding: 0 0.5rem;
} */

/* --- 「閉じる」ボタンのスタイル --- */
.accordion-close-trigger {
    cursor: pointer;
    text-align: right;
    font-size: 0.8em;
    padding: 0.5rem 1rem;
    margin: 0 -0.5rem;
    font-weight: normal;
    color: #666;
    transition: background-color 0.2s;
    /* border-radius: 0 0 0.5rem 0.5rem; */
    background-color: #def8;
}
.accordion-close-trigger:hover {
    background-color: #def;
}

/* ================================================================
   
   ================================================================ */
.stats-group { 
  margin-bottom: 1rem; 
}

.feature-table td { 
  vertical-align: middle; 
}
.feature-table label { 
  font-weight: normal; 
  margin-bottom: 0; 
}

/* ================================================================
   ライフパス
   ================================================================ */
/* ライフパス */
.lifepath-group { 
  margin-bottom: 1rem; 
}
.lifepath-description {
  font-size: 0.9rem; 
  font-weight: normal;
  background-color: var(--code-bg-color);
  background-color: #fffa;
  border: 1px solid #888;
  padding: 0.5rem; 
  border-radius: 0.5rem; 
  box-shadow: 0 0 5px #0128;
  margin: 0.5rem;
  height: auto;
}
.lifepath-description h5 {
  font-size: 1.3rem; 
  font-weight: bold;
  margin: 0 0 0.5rem 0;
  padding: 0;
}
.lifepath-description p {
  font-size: 0.9rem; 
  font-weight: normal;
  padding: 0; 
  margin: 0;
}
.lifepath-description:empty {
  display: none;
}

/* ================================================================
   特徴
   ================================================================ */
/* 特徴システムの配色 */
:root {
    --prime-color-bg: #eee;
    --prime-color-text: #444;
    --prime-color-border: #444; 
    --fallen-color-bg: #666;
    --fallen-color-text: #fff; 
    --fallen-color-border: #fff; 
}

/* 特徴選択リストのスタイル */
.feature-pair-card {
    border: 1px solid var(--border-color);
    border-radius: 16px;
    margin: 0; 
    margin-bottom: 1.0rem;
    background-color: #fffa;
    overflow: hidden;
    box-shadow: 0 0 0.5rem #0128;
    padding: 0.5rem;
}
.feature-option {
    padding: 0.5rem;
    cursor: pointer;
    transition: all 0.2s ease-in-out;
    position: relative; /* 選択状態のマーク用 */
}
.feature-option input[type="radio"] {
    display: none; /* ラジオボタン本体は隠す */
}

/* Prime / Fallen のデザイン */
.feature-option.prime,
.feature-option.fallen {
}
.feature-option.prime {
    background-color: var(--prime-color-bg);
    color: var(--prime-color-text);
    border-radius: 0.5rem 0.5rem 0 0; 
}
.feature-option.prime .pro,
.feature-option.prime .con { 
  color: #666; 
} 

.feature-option.fallen {
    background-color: var(--fallen-color-bg);
    color: var(--fallen-color-text);
    border-radius: 0 0 0.5rem 0.5rem; 
}
.feature-option.fallen .pro,
.feature-option.fallen .con { 
  color: #ddd; 
} 

/* ホバーエフェクト */
.feature-option:hover {
    /* transform: scale(1.1); */
    box-shadow: 0 0 10px #0008;
    /* border-color: #fff; */
    z-index: 10;
}

/* 選択時のデザイン */
.feature-option.selected {
    box-shadow: 0 0 0 4px var(--secondary-color) inset;
}

.feature-option h5 {
    margin: 0 0 0.5rem 0; 
    padding: 0; 
    border: none; 
    font-size: 1.5rem;
    text-align: center;
    font-weight: bold;
}
.feature-option p {
    font-size: 0.9rem; 
    line-height: 1.4; 
    margin: 0; 
    text-indent: 0;
    font-weight: bold;
}
.feature-option .pro { 
  color: var(--success-color); 
  color: #222;
  font-weight: normal;
}
.feature-option .con { 
  color: var(--failure-color); 
  color: #ddd;
  font-weight: normal;
}

/* 選択済み特徴カードのスタイル */
#selected-features-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    margin: 0;
    padding: 0;
}
.selected-feature-card {
    border-radius: 0.5rem;
    padding: 0.5rem;
    margin: 0.5rem 1rem;
    border: 1px solid;
    box-shadow: 0 0 0.5rem #0128;
}

.selected-feature-card.prime-card,
.selected-feature-card.fallen-card {
    /* padding: 1rem; */
    box-shadow: 0 0 0.5rem #0128;
}
.selected-feature-card.prime-card {
    background-color: var(--prime-color-bg);
    border-color: var(--prime-color-border);
    color: var(--prime-color-text);
}
.selected-feature-card.fallen-card {
    background-color: var(--fallen-color-bg);
    border-color: var(--fallen-color-border);
    color: var(--fallen-color-text);
}
.selected-feature-card.prime-card h5, 
.selected-feature-card.fallen-card h5 { 
  margin: 0 0 0.5rem 1rem;
  padding: 0;
  color: var(--primary-color); 
  font-size: 1.5rem;
  font-weight: bold;
}
.selected-feature-card.prime-card h5 {
  color: #000; 
}
.selected-feature-card.fallen-card h5 { 
  color: #fff; 
}
.selected-feature-card.prime-card p, 
.selected-feature-card.fallen-card p { 
  margin: 0;
  padding: 0;
  font-size: 0.9rem;
  font-weight: normal;
}

/* ================================================================
   スキル
   ================================================================ */
.skill-list label { 
  display: flex; 
  align-items: center; 
  font-weight: normal; 
  margin: 0;
  padding: 0;
}
.skill-list input { 
  margin-right: 0.5rem; 
}
/* スキル */
#skill-points-tracker {
    font-size: 1.2em; 
    font-weight: bold; 
    text-align: center; 
    padding: 10px;
    background-color: #6bf; 
    border: 1px solid var(--secondary-color);
    border-radius: 4px; margin-bottom: 1rem;
}
/* スキルカードのスタイル */
.skill-card {
    position: relative;
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    padding: 0.5rem;
    margin-bottom: 0.5rem;
    background-color: #fff;
    cursor: pointer;
    transition: all 0.2s ease-in-out;
    box-shadow: 0 0 0.5rem #0128;
}
.skill-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 0.5rem #0124;
}
.skill-card input[type="checkbox"] {
    display: none; /* チェックボックス本体は隠す */
}

.skill-card-header {
    margin: 0; 
    padding: 0; 
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.skill-card-header h5 {
    margin: 0; 
    padding: 0; 
    border: none; 
    font-size: 1.5rem;
    font-weight: bold; 
}
.skill-card-header span {
    margin: 0; 
    padding: 0; 
    font-size: 0.9rem;
    color: #555;
    font-weight: bold;
}
.skill-card .skill-description {
    font-size: 0.9rem;
    color: #555;
    line-height: 1.4;
    font-weight: normal; 
    margin: 0; 
    padding: 0; 
}

/* 選択/無効状態のスタイル */
.skill-card.selected {
    box-shadow: 0 0 0 3px var(--secondary-color) inset;
    border-color: var(--secondary-color);
}
.skill-card.disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background-color: #f9f9f9;
    pointer-events: none; /* クリックイベントを無効化 */
}
/* 選択済みスキルカードのスタイル */
#selected-skills-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 10px;
    padding: 0 1rem;
    margin: 0.5rem 0;
}
/* ================================================================
   RAベクトル グラフ
   ================================================================ */
/* スキルベクトルグラフのスタイル */
.vector-chart-container {
    margin: 0 0 0.5rem 0;
    padding: 0.5rem;
    background-color: #fff;
    border-radius: 0.5rem;
    box-shadow: 0 0 0.5rem #0128;
}
.vector-chart-container h4 {
    margin-top: 0;
    margin-bottom: 1.5rem;
    text-align: center;
    border: none;
    padding: 0;
}
.vector-chart {
    position: relative;
    width: 100%;
    max-width: 400px;
    aspect-ratio: 1 / 1;
    margin: 0 auto;
    background-color: #def5;
    background-image: 
        linear-gradient(#aaa 1px, transparent 1px),
        linear-gradient(90deg, #aaa 1px, transparent 1px);
    background-size: 12.5% 12.5%;
    background-position: center center;
    border: 1px solid var(--border-color);
}
.vector-axis {
    position: absolute;
    background-color: #999;
}
.vector-axis.x-axis {
    left: 0;
    right: 0;
    top: 50%;
    height: 2px;
    transform: translateY(-50%);
}
.vector-axis.y-axis {
    top: 0;
    bottom: 0;
    left: 50%;
    width: 2px;
    transform: translateX(-50%);
}
.axis-label {
    position: absolute;
    font-size: 12px;
    font-weight: bold;
    color: #555;
    background: rgba(255,255,255,0.7);
    padding: 2px 4px;
}
.axis-label.top { top: 5px; left: 50%; transform: translateX(-50%); }
.axis-label.bottom { bottom: 5px; left: 50%; transform: translateX(-50%); }
.axis-label.left {
    /* 回転後にテキストが枠線と重ならないよう、位置を調整 */
    left: -9%; 
    top: 50%;
    /* 要素を垂直方向に中央揃えした後、90度回転させる */
    transform: translateY(-50%) rotate(90deg);
}
.axis-label.right {
    /* 回転後にテキストが枠線と重ならないよう、位置を調整 */
    right: -9%;
    top: 50%;
    /* 要素を垂直方向に中央揃えした後、90度回転させる */
    transform: translateY(-50%) rotate(-90deg);
}
.quadrant-label {
    position: absolute;
    font-size: 24px; /* 大きめの文字 */
    font-weight: 900;
    color: #0004; /* 背景に溶け込む薄い色 */
    text-align: center;
    user-select: none; /* テキストを選択不可に */
    z-index: 1; /* 軸より手前、ポイントより後ろ */
}
.quadrant-label.q1 { top: 25%; right: 25%; transform: translate(50%, -50%); } /* 右上 */
.quadrant-label.q2 { top: 25%; left: 25%; transform: translate(-50%, -50%); }  /* 左上 */
.quadrant-label.q3 { bottom: 25%; left: 25%; transform: translate(-50%, 50%); } /* 左下 */
.quadrant-label.q4 { bottom: 25%; right: 25%; transform: translate(50%, 50%); } /* 右下 */

.vector-point {
    position: absolute;
    width: 16px;
    height: 16px;
    background-color: var(--secondary-color);
    border: 2px solid #fff;
    border-radius: 50%;
    box-shadow: 0 0 10px var(--secondary-color);
    transform: translate(-50%, -50%);
    transition: all 0.3s ease-in-out;
    z-index: 2; /* ポイントを最前面に */
}
.position-text {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    white-space: nowrap;
    background: var(--primary-color);
    color: #fff;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: bold;
    opacity: 0;
    transition: opacity 0.3s;
}
.vector-point:hover .position-text {
    opacity: 1;
}
.axis-position-label {
    position: absolute;
    font-size: 16px;
    font-weight: 900;
    color: #0004;
    text-align: center;
    user-select: none;
    z-index: 1;
}

/* 各ラベルの位置を個別に指定 */
.axis-position-label.pos-center { 
    top: 50%; 
    left: 50%; 
    transform: translate(-50%, -50%); 
    font-size: 22px;
}
.axis-position-label.pos-a-plus { /* A+軸（上） */
    top: 8%; 
    left: 50%; 
    transform: translateX(-50%); 
}
.axis-position-label.pos-a-minus { /* A-軸（下） */
    bottom: 8%; 
    left: 50%; 
    transform: translateX(-50%); 
}
.axis-position-label.pos-r-minus { /* R-軸（左） */
    top: 50%; 
    left: 5%; 
    transform: translateY(-50%); 
}
.axis-position-label.pos-r-plus { /* R+軸（右） */
    top: 50%; 
    right: 5%; 
    transform: translateY(-50%); 
}

/* ================================================================
   スティッキー能力値フッター（修正版）
   ================================================================ */
/* メインコンテンツの底に余白を追加 */
/* フッターがコンテンツに重なってしまうのを防ぐため、
   フォームの最下部にフッターの高さ分の余白（padding）を確保します。*/
#character-sheet {
    /* フッターの高さを200px程度と想定 */
    padding-bottom: 1rem;
}

/* フッター本体のスタイル */
/* 画面下部に固定する、背景バーとしての役割 */
#stats-sticky-footer {
    position: fixed; /* 画面を基準に位置を固定 */
    bottom: 0;       /* 画面の下端に配置 */
    left: 0;
    right: 0;
    background-color: #defa;
    padding: 1rem;
    z-index: 1000;
    box-shadow: 0 0 0.5rem #0128;
    border-top: 1px solid #888;
    backdrop-filter:         blur(5px);
    -webkit-backdrop-filter: blur(5px);
}

/* フッター内部のコンテンツを中央揃えにするラッパー */
/* ここでレイアウトを制御します */
.stats-sticky-footer-content {
    max-width: 900px; /* .containerの幅と合わせる */
    margin: 0 auto;   /* 中央揃え */
    padding: 0 0.5rem;  /* 左右に余白を追加 */
}

/* フッター内の要素のスタイルを調整 */
/* フッター内では余白を小さくして、コンパクトに見せる */
#stats-sticky-footer .stats-group {
    margin-bottom: 0.5rem; /* グループ間の余白を少し調整 */
}

#stats-sticky-footer .stats-group h3 {
    margin-top: 0;
    margin-bottom: 0.5rem;
    font-size: 1em;
    text-align: center;
}

/* 3列表示を維持するための既存のスタイルがフッター内でも適用されることを確認 */
#stats-sticky-footer .grid-3-col {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
}

/* ================================================================
   フローティングローダー / メッセージ（改修版）
   ================================================================ */
.modal-overlay { 
    position: fixed;
    inset: 0;
    z-index: 2000;
    
    display: none; 
    align-items: center;
    justify-content: center;
    
    opacity: 0;
    transition: opacity 0.2s ease-in-out;
}

/* is-activeクラスが付与されたら、表示状態に切り替える */
.modal-overlay.is-active {
    display: flex; 
    opacity: 1;
}


/* --- トーストモード（バックドロップなし）のスタイル --- */
/* is-toastモードでは、背景の黒い覆いを非表示にする */
.modal-overlay.is-toast .modal-backdrop {
    display: none;
}
/* トーストモードでは、背景の操作をブロックしない */
.modal-overlay.is-toast {
    /* is-toastモードの時だけ、親要素のクリックイベントを無効化する */
    pointer-events: none;
}
.modal-overlay.is-toast .modal-message {
    /* メッセージボックス自体はクリック可能にする */
    pointer-events: auto;
}


/* --- メッセージボックスの色分け --- */
.modal-message.is-error {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.modal-backdrop {
    position: absolute;
    inset: 0;
    background-color: #0004;
    backdrop-filter:         blur(3px);
    -webkit-backdrop-filter: blur(3px);
}

.modal-message {
    position: relative;
    background-color: var(--surface-color);
    color: var(--text-color);
    padding: 2rem 3rem;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    text-align: center;
    font-size: 1.1em;
    font-weight: bold;
}

/* ================================================================
   キャラクター画像プレビュー
   ================================================================ */
.char-image-preview-container {
    margin-bottom: 1rem;
    text-align: center; /* 画像が500px未満のときに中央寄せ */
}

#char-image-preview {
    display: block;
    margin: 0 auto;     /* ブロック要素として中央寄せ */
    width: 100%;        /* 親要素幅いっぱい */
    max-width: 500px;   /* 最大幅500px */
    height: auto;       /* アスペクト比維持 */
    min-height: 200px;  /* 未選択時も領域を確保 */
    object-fit: contain;
    background-color: #eee;
    border: 1px solid #ccc;
    border-radius: 8px;
}

.char-image-controls {
    text-align: left;
}
.char-image-controls input[type="file"] {
    margin-bottom: 0.5rem;
}
.char-image-controls button {
    font-size: 0.8rem;
    padding: 0.2rem 0.5rem;
}
</style>