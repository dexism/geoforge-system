### プロジェクトの概要

この「GeoForge System」は、毎回ユニークな架空世界のマップを生成するWebアプリケーションです。以下のステップで世界を構築していきます。

1.  **大陸生成**: ノイズ関数を用いて、地形、気候、植生などをリアルに生成します。
2.  **文明生成**: 生成された土地の「居住適性」に基づき、国家や集落（首都、都市、村など）を配置します。
3.  **経済シミュレーション**: 各地域での食料生産と消費を計算し、余剰や不足をシミュレートします。
4.  **インフラ（街道）生成**: 地形コストを考慮しながら、A*（エースター）アルゴリズムを用いて集落間を結ぶ合理的な街道網を構築します。
5.  **領土確定**: 街道網や集落の階層に基づき、各ヘックスがどの国家・領土に所属するかを最終決定します。
6.  **データ集計と可視化**: 全ての計算結果を統合し、D3.jsライブラリを用いてインタラクティブなヘックスマップとして描画します。

---

### 各モジュールの主な機能

#### 1. `continentGenerator.js` - 世界の土台を創る
Simplex-noiseというノイズ関数を巧みに利用して、リアルな大陸を生成します。
*   **地形と標高**: 大陸の形状、標高、内陸湖などを生成します。
*   **気候**: 緯度や標高を考慮して気温と降水量を計算し、「温暖湿潤気候」や「ツンドラ気候」など9種類の気候帯に分類します。
*   **水系**: 山岳地帯を水源とする河川をシミュレートし、低地へと流れる様子を再現します。
*   **植生と資源**: 気候や地形に基づき、「森林」「砂漠」「草原」などの植生を決定し、農業、林業、鉱業、漁業のポテンシャル値を各ヘックスに設定します。

#### 2. `civilizationGenerator.js` - 文明の灯をともす
生成された大陸に、人々が住み着き文明を築く過程をシミュレートします。
*   **居住適性の計算**: 農業適性、気温、資源などを総合的に評価し、人々が住みやすい土地を数値化します。
*   **国家の誕生**: 居住適性の高い土地に「首都」を配置し、国家を形成します。
*   **都市階層の構築**: 首都を中心に、「都市」「領都」「街」「町」「村」といった階層的な集落を、一定の距離を保ちながら配置していきます。
*   **領土の確定**: 各集落や空白地が、最終的にどの支配領域に属するかを決定します。

#### 3. `roadGenerator.js` - 人と物資の道をつなぐ
文明の動脈である街道網を、現実的な制約を考慮しながら構築します。
*   **コスト計算**: 地形の険しさ（標高、森林、河川など）に応じて「移動コスト」を設定します。
*   **A\*アルゴリズム**: 最短経路探索アルゴリズムを利用し、コストが最も低くなるように効率的なルートで集落間を結びます。
*   **階層的な街道網**:
    *   まず、主要都市間を「交易路」で結びます。
    *   次に、街や町から最寄りの上位都市や幹線道路へと道を延ばします。
    *   最後に、村々をクラスタ（グループ）にまとめ、代表地点から町へと道を接続します。
*   **親子関係の決定**: 街道網の接続に基づき、各集落がどの都市の支配下にあるか（`parentHexId`）を決定します。

#### 4. `economySimulator.js` - 人々の暮らしを支える
各地域の経済活動、特に食料需給をシミュレートします。
*   **食料生産**: 気候や土地の特性（河川沿いかなど）に応じて主要作物（小麦、稲など）を決定し、労働力やインフラのレベルを考慮して生産量を計算します。
*   **食料消費**: 集落の規模や種類に応じて、住民が必要とする食料の消費量を算出します。
*   **需給バランス**: 生産量と消費量を比較し、食料の余剰（`surplus`）または不足（`shortage`）を作物ごとに割り出します。
*   **領域データの集計**: 主要都市（首都、都市、領都）が庇護する領域全体の人口、農地面積、総生産量などを集計し、都市の持つ経済力を可視化します。

#### 5. `ui.js` - 世界をインタラクティブに描画する
シミュレーションによって生成された膨大なデータを、ユーザーが直感的に理解できるように可視化します。
*   **ヘックスマップ描画**: D3.jsを使い、全てのヘックスを地形や植生に応じた色で塗り分けます。
*   **レイヤー表示**: 国境線、河川、街道、各種オーバーレイ（気候帯、人口、農業適性など）をボタン一つで表示・非表示に切り替えられます。
*   **情報ウィンドウ**: ヘックスをクリックすると、座標、人口、気候、経済状況などの詳細なデータがフローティングウィンドウに表示されます。
*   **支配領域のハイライト**: 主要都市をクリックすると、その都市が支配下に置く全ての領土が階層に応じて色分けされ、勢力範囲が一目で分かります。
