### プロジェクトの概要

この「GeoForge System」は、毎回ユニークな架空世界のマップを生成するWebアプリケーションです。以下のステップで世界を構築していきます。

1.  **大陸生成**: ノイズ関数を用いて、地形、気候、植生などをリアルに生成します。
2.  **文明生成**: 生成された土地の「居住適性」に基づき、国家や集落（首都、都市、村など）を配置します。
3.  **経済シミュレーション**: 各地域での食料生産と消費を計算し、余剰や不足をシミュレートします。
4.  **インフラ（街道）生成**: 地形コストを考慮しながら、A*（エースター）アルゴリズムを用いて集落間を結ぶ合理的な街道網を構築します。
5.  **領土確定**: 街道網や集落の階層に基づき、各ヘックスがどの国家・領土に所属するかを最終決定します。
6.  **データ集計と可視化**: 全ての計算結果を統合し、D3.jsライブラリを用いてインタラクティブなヘックスマップとして描画します。

---

### 各モジュールの主な機能

#### 1. `continentGenerator.js` - 世界の土台を創る
Simplex-noiseというノイズ関数を巧みに利用して、リアルな大陸を生成します。
*   **地形と標高**: 大陸の形状、標高、内陸湖などを生成します。
*   **気候**: 緯度や標高を考慮して気温と降水量を計算し、「温暖湿潤気候」や「ツンドラ気候」など9種類の気候帯に分類します。
*   **水系**: 山岳地帯を水源とする河川をシミュレートし、低地へと流れる様子を再現します。
*   **植生と資源**: 気候や地形に基づき、「森林」「砂漠」「草原」などの植生を決定し、農業、林業、鉱業、漁業のポテンシャル値を各ヘックスに設定します。

#### 2. `civilizationGenerator.js` - 文明の灯をともす
生成された大陸に、人々が住み着き文明を築く過程をシミュレートします。
*   **居住適性の計算**: 農業適性、気温、資源などを総合的に評価し、人々が住みやすい土地を数値化します。
*   **国家の誕生**: 居住適性の高い土地に「首都」を配置し、国家を形成します。
*   **都市階層の構築**: 首都を中心に、「都市」「領都」「街」「町」「村」といった階層的な集落を、一定の距離を保ちながら配置していきます。
*   **領土の確定**: 各集落や空白地が、最終的にどの支配領域に属するかを決定します。

#### 3. `roadGenerator.js` - 人と物資の道をつなぐ
文明の動脈である街道網を、現実的な制約を考慮しながら構築します。
*   **コスト計算**: 地形の険しさ（標高、森林、河川など）に応じて「移動コスト」を設定します。
*   **A\*アルゴリズム**: 最短経路探索アルゴリズムを利用し、コストが最も低くなるように効率的なルートで集落間を結びます。
*   **階層的な街道網**:
    *   まず、主要都市間を「交易路」で結びます。
    *   次に、街や町から最寄りの上位都市や幹線道路へと道を延ばします。
    *   最後に、村々をクラスタ（グループ）にまとめ、代表地点から町へと道を接続します。
*   **親子関係の決定**: 街道網の接続に基づき、各集落がどの都市の支配下にあるか（`parentHexId`）を決定します。

#### 4. `economySimulator.js` - 人々の暮らしを支える
各地域の経済活動、特に食料需給をシミュレートします。
*   **食料生産**: 気候や土地の特性（河川沿いかなど）に応じて主要作物（小麦、稲など）を決定し、労働力やインフラのレベルを考慮して生産量を計算します。
*   **食料消費**: 集落の規模や種類に応じて、住民が必要とする食料の消費量を算出します。
*   **需給バランス**: 生産量と消費量を比較し、食料の余剰（`surplus`）または不足（`shortage`）を作物ごとに割り出します。
*   **領域データの集計**: 主要都市（首都、都市、領都）が庇護する領域全体の人口、農地面積、総生産量などを集計し、都市の持つ経済力を可視化します。

#### 5. `ui.js` - 世界をインタラクティブに描画する
シミュレーションによって生成された膨大なデータを、ユーザーが直感的に理解できるように可視化します。
*   **ヘックスマップ描画**: D3.jsを使い、全てのヘックスを地形や植生に応じた色で塗り分けます。
*   **レイヤー表示**: 国境線、河川、街道、各種オーバーレイ（気候帯、人口、農業適性など）をボタン一つで表示・非表示に切り替えられます。
*   **情報ウィンドウ**: ヘックスをクリックすると、座標、人口、気候、経済状況などの詳細なデータがフローティングウィンドウに表示されます。
*   **支配領域のハイライト**: 主要都市をクリックすると、その都市が支配下に置く全ての領土が階層に応じて色分けされ、勢力範囲が一目で分かります。

### 産業と経済
産業構造を区分。「魔法」「ギルド」「宗教」が各産業に深く関わり、産業間の結びつきが強い。

1. **第一次産業**: 資源を得る
2. **第二次産業**: 資源を加工する
3. **第三次産業**: 人にサービスを提供する
4. **第四次産業**: 知識と情報を扱う
5. **第五次産業**: 社会を統治・創造する

#### 1. 第一次産業 - 自然資源の獲得
*   **農業**: 麦・野菜・果樹・薬草栽培。魔法農法や精霊の加護で収穫量増加。
*   **牧畜**: 牛・羊・魔物など。乳製品や毛皮、魔獣素材の供給。
*   **漁業**: 川・湖・海での漁。漁師ギルドとの協力。
*   **採掘**: 鉱石・宝石・魔鉱石。鍛冶屋や魔導具師の基盤。
*   **林業**: 木材・薬木・魔樹。建築資材や魔法触媒。

#### 2. 第二次産業 - 加工・製造
*   **鍛冶・工房**: 武器防具、魔導具、生活道具。職人ギルドが中心。
*   **錬金術**: 薬品・ポーション・触媒の製造。素材は第一次産業から供給。
*   **建築**: 城・都市・村の建設。石工ギルドや魔法建築師。
*   **織物・染色**: 羊毛や麻、魔獣皮を加工。貴族向け衣装から冒険者装備まで。

#### 3. 第三次産業 - サービス
*   **商業**: 市場・行商・ギルドによる流通。交易路や港町が発展。
*   **宿泊・飲食**: 酒場・宿屋・料理店。冒険者の拠点。
*   **交通**: 馬車・船・飛竜便。安全な移動を提供。
*   **医療・癒し**: 僧侶・薬師・治癒師。ポーション販売や施術。
*   **教育**: 魔法学校・剣術道場。知識と技能の伝承。

#### 4. 第四次産業 - 知識・情報
*   **魔法研究**: 魔術ギルド、大学、賢者の塔。新しい呪文や魔導理論の開発。
*   **戦略・軍事学**: 王国軍や冒険者ギルドの戦術研究。
*   **学問**: 歴史学・地理学・神話研究。世界観の体系化。
*   **情報収集**: 占い師・予言者・諜報組織。未来予測や敵国情報。

#### 5. 第五次産業 - 統治・創造
*   **王政・貴族政治**: 国家運営、外交、税制。
*   **宗教・信仰**: 神殿・教会・司祭。精神的支柱と社会秩序。
*   **芸術・文化**: 吟遊詩人、劇団、画家。物語や伝承を広める。
*   **職能ギルド**: 依頼仲介、世界の安全保障。産業横断的な存在。
*   **創造的魔法**: 新しい世界観や文明を生み出す力。
